<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Getting started with GNU gettext for C++ | erri120's random Blog</title><meta name=keywords content="C++,i18n"><meta name=description content="GNU gettext is a very useful i18n and l10n tool that makes it easy to add translations in our code."><meta name=author content="erri120"><link rel=canonical href=https://erri120.github.io/posts/2022-05-05/><link crossorigin=anonymous href=/assets/css/stylesheet.css rel="preload stylesheet" as=style><link rel=icon href=https://erri120.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://erri120.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://erri120.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://erri120.github.io/apple-touch-icon.png><link rel=mask-icon href=https://erri120.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://erri120.github.io/posts/2022-05-05/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta name=google-site-verification content="c-L5KbBKeVyZ9YNKiotqlpl7zsiDRiGcWJa4ZxVpzAo"><meta name=msvalidate.01 content="0E353603CBFC6B4F85D605C4E9F27290"><script data-goatcounter=https://erri120.goatcounter.com/count async src=//gc.zgo.at/count.js></script><link rel=stylesheet href=/syntax.css><meta property="og:url" content="https://erri120.github.io/posts/2022-05-05/"><meta property="og:site_name" content="erri120's random Blog"><meta property="og:title" content="Getting started with GNU gettext for C++"><meta property="og:description" content="GNU gettext is a very useful i18n and l10n tool that makes it easy to add translations in our code."><meta property="og:locale" content="en-US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-05-05T00:00:00+00:00"><meta property="article:modified_time" content="2022-11-09T15:47:51+01:00"><meta property="article:tag" content="C++"><meta property="article:tag" content="I18n"><meta name=twitter:card content="summary"><meta name=twitter:title content="Getting started with GNU gettext for C++"><meta name=twitter:description content="GNU gettext is a very useful i18n and l10n tool that makes it easy to add translations in our code."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://erri120.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Getting started with GNU gettext for C++","item":"https://erri120.github.io/posts/2022-05-05/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Getting started with GNU gettext for C++","name":"Getting started with GNU gettext for C\u002b\u002b","description":"GNU gettext is a very useful i18n and l10n tool that makes it easy to add translations in our code.","keywords":["C++","i18n"],"articleBody":"Following my post on Character encodings and Unicode it is now time to talk about i18n with GNU gettext. We will look at i18n and l10n in general and then talk about how gettext can make our live as programmers very easy.\ni18n and l10n - Internationalization and Localization Due to the length of Internationalization and Localization you can just write i18n and l10n which are “numeronyms”, number based words that are formed by taking the first and last character of the words and putting the amount of letters between these two characters in the middle, so for Internationalization it starts with an i and ends with an n and has 18 letters in-between resulting in i18n.\nFor us software developers these terms mean adapting our code to be locale agnostic. If you create a UI and hard-code all strings then the users won’t be able to change the language. Aside from normal translations i18n and l10n also encompasses formatting rules for numbers, date and time, currency and things like text layout. Some languages read left to right, others right to left. Instead of reading horizontally there are also cultures where you read vertically.\nAll of this might seem overwhelming and in reality you will likely never have to deal with this. For Open-Source projects it’s often enough to just have everything in English and maybe provide a way to load translations.\nGNU gettext and libintl i18n and l10n is all nice and good, but how should we programmers design our software to support these concepts? This is where gettext and libintl come into play.\nIn 1995 the GNU projects released GNU gettext into the world. The package offers an integrated set of tools as well as the libintl runtime library for dealing with translations. We will take a look at the tools xgettext, msginit, msgmerge and msgfmt, how to use the gettext library in our code and what the process of creating translations is.\nCMake Setup In order for us to use libintl in our code we need to get it from somewhere. In this example we will use CMake and vcpkg.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 cmake_minimum_required(VERSION 3.8) project ( \"CppInternationalization\" VERSION 1.0.0 LANGUAGES CXX ) # Using C++20 set(CMAKE_CXX_STANDARD 20) set(CMAKE_CXX_STANDARD_REQUIRED ON) set(CMAKE_CXX_EXTENSIONS OFF) add_executable(${PROJECT_NAME} \"main.cpp\") # add libintl find_package(Intl REQUIRED) target_link_libraries(${PROJECT_NAME} PUBLIC ${Intl_LIBRARY}) target_include_directories(${PROJECT_NAME} PUBLIC ${Intl_INCLUDE_DIRS}) This is a very basic CMakeLists.txt file containing one dependency which we will get with vcpkg using vcpkg install gettext[tools]. The tools feature is very important so we can get the programs required for our setup.\nCode Setup 1 2 3 4 5 6 7 #include #include int main() { std::cout \u003c\u003c \"Hello World!\" \u003c\u003c std::endl; return EXIT_SUCCESS; } This is the most basic C++ program possible. In the code we hard-coded the string Hello World!, and now we want to provide translations. The libintl runtime library has exactly what we need:\n1 2 3 4 5 6 7 8 #include #include #include int main() { std::cout \u003c\u003c gettext(\"Hello World!\") \u003c\u003c std::endl; return EXIT_SUCCESS; } The gettext function from the libintl.h header will now look for a translation of the string Hello World! for the current locale at runtime. If it does not find a translation it will just use Hello World! which is very nice since we only have to wrap all the strings in gettext(). If gettext is too long you can create a macro:\n1 2 3 4 5 6 7 8 9 10 #include #include #include #define _(String) gettext(String) int main() { std::cout \u003c\u003c _(\"Hello World!\") \u003c\u003c std::endl; return EXIT_SUCCESS; } This macro is very commonly used in projects that use GNU gettext and even included in frameworks like GTK.\nSo where does gettext() look for my translations? You will have to specify that with bindtextdomain:\n1 2 3 4 5 6 7 8 9 10 11 12 13 #include #include #include #define _(String) gettext(String) int main() { bindtextdomain(\"my-domain\", \"locales\"); textdomain(\"my-domain\"); std::cout \u003c\u003c _(\"Hello World!\") \u003c\u003c std::endl; return EXIT_SUCCESS; } Now at runtime if the user has the de locale set, gettext() will look at locales/de/LC_MESSAGES/my-domain.mo for a translation. Let’s break this path down:\nlocales: the folder specified in bindtextdomain de: the current locale LC_MESSAGES: the category name of the translation my-domain.mo: the binary message catalog containing all translations. The file name is what you specified in bindtextdomain as well as textdomain There are few things that need explaining. The library will first try and find an exact match of the current locale but if that is not possible it will look for similar locales. As an example if the user has de_DE, but you only provided de then the library will first look for de_DE and when it doesn’t find it, it will look for an expanded locale like de.\nThe LC_MESSAGES part of the path is the category name of the translation we are looking for. LC stands for locale category and there are various others like LC_CTYPE, LC_NUMERIC, LC_TIME, LC_MONETARY which all specify how to handle various things like numbers, dates and currency. For our purposes we only focus on messages, raw strings or texts we want to translate. gettext will always use LC_MESSAGES as its category. There are other functions that will let you specify which category you want to look for like dcgettext but for this post we won’t look at those.\nThe .mo file is the message catalog which has to be generated. So let’s look at how that works next.\nInitial Project Setup In our very complex example we have marked the Hello World! string as a translatable string. We can now use xgettext to extract these marked strings:\n1 xgettext main.cpp --keyword=\"_\" --output=\"locales/my-domain.pot\" This .pot file is a Portable Object Template file. It can look like this:\n# SOME DESCRIPTIVE TITLE. # FIRST AUTHOR , YEAR. # #, fuzzy msgid \"\" msgstr \"\" \"POT-Creation-Date: 2022-05-05 14:47+0200\\n\" \"PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\\n\" \"Last-Translator: FULL NAME \\n\" \"Language-Team: LANGUAGE \\n\" \"Language: \\n\" \"MIME-Version: 1.0\\n\" \"Content-Type: text/plain; charset=CHARSET\\n\" \"Content-Transfer-Encoding: 8bit\\n\" #: main.cpp:10 msgid \"Hello World!\" msgstr \"\" At the bottom you can find our Hello World! string which comes from main.cpp at line 10. This file can now be used to create .po, Portable Object files using msginit:\n1 msginit --input=\"locales/my-domain.pot\" --output-file=\"locales/de/my-domain.po\" --locale=\"de\" Every language you want to support gets its own .po file. The .pot is just a template used to create the .po files with. The .po file looks almost the same:\nmsgid \"\" msgstr \"\" \"POT-Creation-Date: 2022-05-05 14:47+0200\\n\" \"PO-Revision-Date: 2022-05-04 18:41+0200\\n\" \"Last-Translator: \\n\" \"Language-Team: German\\n\" \"Language: de\\n\" \"MIME-Version: 1.0\\n\" \"Content-Type: text/plain; charset=CP1252\\n\" \"Content-Transfer-Encoding: 8bit\\n\" \"Plural-Forms: nplurals=2; plural=(n != 1);\\n\" \"X-Generator: Poedit 3.0.1\\n\" #: main.cpp:10 msgid \"Hello World!\" msgstr \"Hallo Welt!\" I already went ahead and translated Hello World! to Hallo Welt! using Poedit, but there are other tools like KBabel, Gtranslator, PO Mode and more which you can use to edit the .po files. The ecosystem is very mature and platforms like transifex also support it.\nNow with your fully or partially translated .po file in hand we will use msgfmt to create our final output file:\n1 msgfmt \"locales/de/my-domain.po\" --output-file=\"locales/de/my-domain.mo\" You now have a .mo file that can be loaded at runtime. But what happens when you change your code? How do you update your .pot, .po and .mo files when there are new, removed or changed strings in your code?\nSource changed, what to do? What we looked at so far is the initial setup phase. This is what you do when you have no previous .pot or .po files and generate them for the first time. If you already have them and the code changed you need to run xgettext again:\n1 xgettext main.cpp --keyword=\"_\" --output=\"locales/my-domain.pot\" The .pot file can be overwritten as you please since it only holds generated content. The .po files are more important since you don’t want to re-do all translations. For this reason we use msgmerge to update the .po files with the new template:\n1 msgmerge \"locales/de/my-domain.po\" \"locales/my-domain.pot\" --output-file=\"locales/de/my-domain.po\" The tool takes the current .po file and the new .pot file as input and spits out an updated .po file that keeps your existing translations as long as they are still used.\nAutomating and integrating with CMake If you found all of this extremely tedious to do by hand then you are not alone. Of course we can automate the generating and updating for all the required files as well as copying the .mo files to our output at build time using a CMake script.\nTo get started, grab a copy this script or add the repository as a submodule. In your CMakeLists.txt file we need to add some lines:\n1 2 3 4 5 6 7 8 9 10 # setup gettext set(GETTEXT_DOMAIN \"my-domain\") set(GETTEXT_TARGET \"gettext-target\") set(GETTEXT_OUTPUT_DIR \"locales\") set(GETTEXT_LANGUAGES \"en\" \"de\") target_compile_definitions(${PROJECT_NAME} PUBLIC \"GETTEXT_DOMAIN=\\\"${GETTEXT_DOMAIN}\\\"\") target_compile_definitions(${PROJECT_NAME} PUBLIC \"GETTEXT_OUTPUT_DIR=\\\"${GETTEXT_OUTPUT_DIR}\\\"\") First we specify some variables and add GETTEXT_DOMAIN and GETTEXT_OUTPUT_DIR as a predefined macro so we can use it in our code. I suggest you change the domain name and the list of languages you want to use.\nNext we want to add the previously downloaded script:\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 include(\"extern/gettext-cmake/Gettext_helpers.cmake\") CONFIGURE_GETTEXT( DOMAIN ${GETTEXT_DOMAIN} TARGET_NAME ${GETTEXT_TARGET} SOURCES \"main.cpp\" POTFILE_DESTINATION ${GETTEXT_OUTPUT_DIR} XGETTEXT_ARGS \"--keyword=_\" \"--add-comments=TRANSLATORS:\" \"--package-name=${PROJECT_NAME}\" \"--package-version=${PROJECT_VERSION}\" \"--msgid-bugs-address=\" \"--copyright-holder=erri120\" LANGUAGES ${GETTEXT_LANGUAGES} BUILD_DESTINATION $\u003cTARGET_FILE_DIR:${PROJECT_NAME}\u003e/${GETTEXT_OUTPUT_DIR} ALL ) There is lots to configure so let’s go through it all:\nDOMAIN set the domain name TARGET_NAME: set the CMake target name SOURCES: set a list of all source files that xgettext should look through, I suggest creating some variable that holds all your sources POTFILE_DESTINATION: this is the directory where the .pot file goes XGETTEXT_ARGS: most of the extra arguments supplied are just for flavor like specifying the package name, version as well as the address where you can report bugs and the copyright holder LANGAUGES: set the list of languages we want to support BUILD_DESTINATION: the top-level output folder for the generated .mo files ALL: adds the custom CMake target to the default build target so that it will be run every time And that’s it. Doing a CMake configure will generate the .pot and .po files, and you now have some new targets that will generate the .mo files.\nComplete Code Example 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 #include #include #include #if WIN32 #define WIN32_LEAN_AND_MEAN #include #endif #define _(STRING) gettext(STRING) static void setup_i18n(const std::string_view locale) { #if WIN32 // LocaleNameToLCID requires a LPCWSTR so we need to convert from char to wchar_t const auto wStringSize = MultiByteToWideChar(CP_UTF8, 0, locale.data(), static_cast\u003cint\u003e(locale.length()), nullptr, 0); std::wstring localeName; localeName.reserve(wStringSize); MultiByteToWideChar(CP_UTF8, 0, locale.data(), static_cast\u003cint\u003e(locale.length()), localeName.data(), wStringSize); _configthreadlocale(_DISABLE_PER_THREAD_LOCALE); const auto localeId = LocaleNameToLCID(localeName.c_str(), LOCALE_ALLOW_NEUTRAL_NAMES); SetThreadLocale(localeId); #else setlocale(LC_MESSAGES, locale.data()); #endif bindtextdomain(GETTEXT_DOMAIN, GETTEXT_OUTPUT_DIR); bind_textdomain_codeset(GETTEXT_DOMAIN, \"UTF-8\"); textdomain(GETTEXT_DOMAIN); } int main() { setup_i18n(\"de\"); std::cout \u003c\u003c _(\"Hello World!\") \u003c\u003c std::endl; return EXIT_SUCCESS; } Woah, what happened with our 12 lines of code? Things are sadly not as easy as you want them to be. The main function is still the same, we have our marked string Hello World! but now there is the new function setup_i18n.\nThis new function takes a std::string_view as an argument and sets the current locale to something new. In this case I want to change the locale to de so my German translation for Hello World! can be loaded. In your actual code you’d want to have some language option the user can change which would call this function with the new locale.\nThe thing that makes this messy is of course the difference between systems. On a POSIX compliant system you can just call setlocale(LC_MESSAGES, \"de\"), but this doesn’t work at all for Windows.\nOn Windows you need to use SetThreadLocale which requires a locale ID that you can get from a name like de using LocaleNameToLCID. The _configthreadlocale(_DISABLE_PER_THREAD_LOCALE) call is important because SetThreadLocale only affects the current thread, who would have thought, so we want to disable this behavior and change the locale of this and all future threads.\nThe code after that uses the new predefined macros we added in our CMake file and I also added a call to the very useful bind_textdomain_codeset function. I suggest reading my Character encodings and Unicode where I explain the mess that is Code Pages and Unicode. With this function call gettext will always return a UTF-8 string. If you don’t want that or don’t need that you can remove this call but for frameworks like GTK it is required as they accept UTF-8 only.\nAlternatives GNU gettext has been around for over 30 years, it is battle tested, has great support and a matured ecosystem. However, if this is not for you or if you can’t use it there are a few alternatives available:\nDIY: always possible but highly discouraged Qt: of course the Qt-ecosystem has a different way of doing translations ICU: International Components for Unicode have ICU4C however it is not easy to use at all Boost.Locale they use ICU as a backend POSIX: catgets this was created back in 1987 before GNU gettext Win32: LoadString with this you can load string resources by ID ","wordCount":"2242","inLanguage":"en","datePublished":"2022-05-05T00:00:00Z","dateModified":"2022-11-09T15:47:51+01:00","author":{"@type":"Person","name":"erri120"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://erri120.github.io/posts/2022-05-05/"},"publisher":{"@type":"Organization","name":"erri120's random Blog","logo":{"@type":"ImageObject","url":"https://erri120.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://erri120.github.io/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://erri120.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://erri120.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://erri120.github.io/archives/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://erri120.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://erri120.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Getting started with GNU gettext for C++</h1><div class=post-meta><span title='2022-05-05 00:00:00 +0000 UTC'>2022-05-05</span>&nbsp;·&nbsp;11 min&nbsp;·&nbsp;2242 words&nbsp;·&nbsp;erri120&nbsp;|&nbsp;<a href=https://github.com/erri120/erri120.github.io/edit/master/content/posts/2022-05-05.md rel="noopener noreferrer edit" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#i18n-and-l10n---internationalization-and-localization>i18n and l10n - Internationalization and Localization</a></li><li><a href=#gnu-gettext-and-libintl>GNU gettext and libintl</a><ul><li><a href=#cmake-setup>CMake Setup</a></li><li><a href=#code-setup>Code Setup</a></li><li><a href=#initial-project-setup>Initial Project Setup</a></li><li><a href=#source-changed-what-to-do>Source changed, what to do?</a></li><li><a href=#automating-and-integrating-with-cmake>Automating and integrating with CMake</a></li><li><a href=#complete-code-example>Complete Code Example</a></li><li><a href=#alternatives>Alternatives</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>Following my post on <a href=https://erri120.github.io/posts/2022-04-15/>Character encodings and Unicode</a> it is now time to talk about i18n with <a href=https://www.gnu.org/software/gettext/>GNU gettext</a>. We will look at i18n and l10n in general and then talk about how <code>gettext</code> can make our live as programmers very easy.</p><h2 id=i18n-and-l10n---internationalization-and-localization>i18n and l10n - Internationalization and Localization<a hidden class=anchor aria-hidden=true href=#i18n-and-l10n---internationalization-and-localization>#</a></h2><p>Due to the length of <em>Internationalization and Localization</em> you can just write i18n and l10n which are &ldquo;numeronyms&rdquo;, number based words that are formed by taking the first and last character of the words and putting the amount of letters between these two characters in the middle, so for <em>Internationalization</em> it starts with an <code>i</code> and ends with an <code>n</code> and has 18 letters in-between resulting in <code>i18n</code>.</p><p>For us software developers these terms mean adapting our code to be locale agnostic. If you create a UI and hard-code all strings then the users won&rsquo;t be able to change the language. Aside from normal translations i18n and l10n also encompasses formatting rules for numbers, date and time, currency and things like text layout. Some languages read left to right, others right to left. Instead of reading horizontally there are also cultures where you read vertically.</p><p>All of this might seem overwhelming and in reality you will likely never have to deal with this. For Open-Source projects it&rsquo;s often enough to just have everything in English and maybe provide a way to load translations.</p><h2 id=gnu-gettext-and-libintl>GNU gettext and libintl<a hidden class=anchor aria-hidden=true href=#gnu-gettext-and-libintl>#</a></h2><p>i18n and l10n is all nice and good, but how should we programmers design our software to support these concepts? This is where <code>gettext</code> and <code>libintl</code> come into play.</p><p>In 1995 the GNU projects released GNU gettext into the world. The package offers an integrated set of tools as well as the <code>libintl</code> runtime library for dealing with translations. We will take a look at the tools <code>xgettext</code>, <code>msginit</code>, <code>msgmerge</code> and <code>msgfmt</code>, how to use the <code>gettext</code> library in our code and what the process of creating translations is.</p><h3 id=cmake-setup>CMake Setup<a hidden class=anchor aria-hidden=true href=#cmake-setup>#</a></h3><p>In order for us to use <code>libintl</code> in our code we need to get it from somewhere. In this example we will use <a href=https://cmake.org>CMake</a> and <a href=https://github.com/microsoft/vcpkg>vcpkg</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=line><span class=cl><span class=nb>cmake_minimum_required</span><span class=p>(</span><span class=s>VERSION</span> <span class=s>3.8</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>project</span> <span class=p>(</span>
</span></span><span class=line><span class=cl> <span class=s2>&#34;CppInternationalization&#34;</span>
</span></span><span class=line><span class=cl> <span class=s>VERSION</span> <span class=s>1.0.0</span>
</span></span><span class=line><span class=cl> <span class=s>LANGUAGES</span> <span class=s>CXX</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># Using C++20
</span></span></span><span class=line><span class=cl><span class=c></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>CMAKE_CXX_STANDARD</span> <span class=s>20</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>CMAKE_CXX_STANDARD_REQUIRED</span> <span class=s>ON</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>CMAKE_CXX_EXTENSIONS</span> <span class=s>OFF</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>add_executable</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s2>&#34;main.cpp&#34;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># add libintl
</span></span></span><span class=line><span class=cl><span class=c></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>find_package</span><span class=p>(</span><span class=s>Intl</span> <span class=s>REQUIRED</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>target_link_libraries</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=o>${</span><span class=nv>Intl_LIBRARY</span><span class=o>}</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>target_include_directories</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=o>${</span><span class=nv>Intl_INCLUDE_DIRS</span><span class=o>}</span><span class=p>)</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>This is a very basic <code>CMakeLists.txt</code> file containing one dependency which we will get with vcpkg using <code>vcpkg install gettext[tools]</code>. The <code>tools</code> feature is very important so we can get the programs required for our setup.</p><h3 id=code-setup>Code Setup<a hidden class=anchor aria-hidden=true href=#code-setup>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstdlib&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=s>&#34;Hello World!&#34;</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This is the most basic C++ program possible. In the code we hard-coded the string <code>Hello World!</code>, and now we want to provide translations. The <code>libintl</code> runtime library has exactly what we need:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstdlib&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;libintl.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>gettext</span><span class=p>(</span><span class=s>&#34;Hello World!&#34;</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The <code>gettext</code> function from the <code>libintl.h</code> header will now look for a translation of the string <code>Hello World!</code> for the current locale at runtime. If it does not find a translation it will just use <code>Hello World!</code> which is very nice since we only have to wrap all the strings in <code>gettext()</code>. If <code>gettext</code> is too long you can create a macro:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstdlib&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;libintl.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define _(String) gettext(String)
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>_</span><span class=p>(</span><span class=s>&#34;Hello World!&#34;</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This macro is very commonly used in projects that use GNU gettext and even included in frameworks like GTK.</p><p>So where does <code>gettext()</code> look for my translations? You will have to specify that with <code>bindtextdomain</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstdlib&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;libintl.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define _(String) gettext(String)
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>bindtextdomain</span><span class=p>(</span><span class=s>&#34;my-domain&#34;</span><span class=p>,</span> <span class=s>&#34;locales&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>textdomain</span><span class=p>(</span><span class=s>&#34;my-domain&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>_</span><span class=p>(</span><span class=s>&#34;Hello World!&#34;</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Now at runtime if the user has the <code>de</code> locale set, <code>gettext()</code> will look at <code>locales/de/LC_MESSAGES/my-domain.mo</code> for a translation. Let&rsquo;s break this path down:</p><ul><li><code>locales</code>: the folder specified in <code>bindtextdomain</code></li><li><code>de</code>: the current locale</li><li><code>LC_MESSAGES</code>: the category name of the translation</li><li><code>my-domain.mo</code>: the binary message catalog containing all translations. The file name is what you specified in <code>bindtextdomain</code> as well as <code>textdomain</code></li></ul><p>There are few things that need explaining. The library will first try and find an exact match of the current locale but if that is not possible it will look for similar locales. As an example if the user has <code>de_DE</code>, but you only provided <code>de</code> then the library will first look for <code>de_DE</code> and when it doesn&rsquo;t find it, it will look for an expanded locale like <code>de</code>.</p><p>The <code>LC_MESSAGES</code> part of the path is the category name of the translation we are looking for. <code>LC</code> stands for locale category and there are various others like <code>LC_CTYPE</code>, <code>LC_NUMERIC</code>, <code>LC_TIME</code>, <code>LC_MONETARY</code> which all specify how to handle various things like numbers, dates and currency. For our purposes we only focus on messages, raw strings or texts we want to translate. <code>gettext</code> will always use <code>LC_MESSAGES</code> as its category. There are other functions that will let you specify which category you want to look for like <code>dcgettext</code> but for this post we won&rsquo;t look at those.</p><p>The <code>.mo</code> file is the message catalog which has to be generated. So let&rsquo;s look at how that works next.</p><h3 id=initial-project-setup>Initial Project Setup<a hidden class=anchor aria-hidden=true href=#initial-project-setup>#</a></h3><p>In our very complex example we have marked the <code>Hello World!</code> string as a translatable string. We can now use <code>xgettext</code> to extract these marked strings:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>xgettext main.cpp --keyword<span class=o>=</span><span class=s2>&#34;_&#34;</span> --output<span class=o>=</span><span class=s2>&#34;locales/my-domain.pot&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>This <code>.pot</code> file is a <em>Portable Object Template</em> file. It can look like this:</p><pre tabindex=0><code class=language-pot data-lang=pot># SOME DESCRIPTIVE TITLE.
# FIRST AUTHOR &lt;EMAIL@ADDRESS&gt;, YEAR.
#
#, fuzzy
msgid &#34;&#34;
msgstr &#34;&#34;
&#34;POT-Creation-Date: 2022-05-05 14:47+0200\n&#34;
&#34;PO-Revision-Date: YEAR-MO-DA HO:MI+ZONE\n&#34;
&#34;Last-Translator: FULL NAME &lt;EMAIL@ADDRESS&gt;\n&#34;
&#34;Language-Team: LANGUAGE &lt;LL@li.org&gt;\n&#34;
&#34;Language: \n&#34;
&#34;MIME-Version: 1.0\n&#34;
&#34;Content-Type: text/plain; charset=CHARSET\n&#34;
&#34;Content-Transfer-Encoding: 8bit\n&#34;

#: main.cpp:10
msgid &#34;Hello World!&#34;
msgstr &#34;&#34;
</code></pre><p>At the bottom you can find our <code>Hello World!</code> string which comes from <code>main.cpp</code> at line <code>10</code>. This file can now be used to create <code>.po</code>, <em>Portable Object</em> files using <code>msginit</code>:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>msginit --input<span class=o>=</span><span class=s2>&#34;locales/my-domain.pot&#34;</span> --output-file<span class=o>=</span><span class=s2>&#34;locales/de/my-domain.po&#34;</span> --locale<span class=o>=</span><span class=s2>&#34;de&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>Every language you want to support gets its own <code>.po</code> file. The <code>.pot</code> is just a <em>template</em> used to create the <code>.po</code> files with. The <code>.po</code> file looks almost the same:</p><pre tabindex=0><code class=language-po data-lang=po>msgid &#34;&#34;
msgstr &#34;&#34;
&#34;POT-Creation-Date: 2022-05-05 14:47+0200\n&#34;
&#34;PO-Revision-Date: 2022-05-04 18:41+0200\n&#34;
&#34;Last-Translator: &lt;EMAIL@ADDRESS&gt;\n&#34;
&#34;Language-Team: German\n&#34;
&#34;Language: de\n&#34;
&#34;MIME-Version: 1.0\n&#34;
&#34;Content-Type: text/plain; charset=CP1252\n&#34;
&#34;Content-Transfer-Encoding: 8bit\n&#34;
&#34;Plural-Forms: nplurals=2; plural=(n != 1);\n&#34;
&#34;X-Generator: Poedit 3.0.1\n&#34;

#: main.cpp:10
msgid &#34;Hello World!&#34;
msgstr &#34;Hallo Welt!&#34;
</code></pre><p>I already went ahead and translated <code>Hello World!</code> to <code>Hallo Welt!</code> using <a href=https://poedit.net/>Poedit</a>, but there are other tools like <em>KBabel</em>, <em>Gtranslator</em>, <em>PO Mode</em> and more which you can use to edit the <code>.po</code> files. The ecosystem is very mature and platforms like <a href=https://docs.transifex.com/formats/gettext>transifex</a> also support it.</p><p>Now with your fully or partially translated <code>.po</code> file in hand we will use <code>msgfmt</code> to create our final output file:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>msgfmt <span class=s2>&#34;locales/de/my-domain.po&#34;</span> --output-file<span class=o>=</span><span class=s2>&#34;locales/de/my-domain.mo&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>You now have a <code>.mo</code> file that can be loaded at runtime. But what happens when you change your code? How do you update your <code>.pot</code>, <code>.po</code> and <code>.mo</code> files when there are new, removed or changed strings in your code?</p><h3 id=source-changed-what-to-do>Source changed, what to do?<a hidden class=anchor aria-hidden=true href=#source-changed-what-to-do>#</a></h3><p>What we looked at so far is the initial setup phase. This is what you do when you have no previous <code>.pot</code> or <code>.po</code> files and generate them for the first time. If you already have them and the code changed you need to run <code>xgettext</code> again:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>xgettext main.cpp --keyword<span class=o>=</span><span class=s2>&#34;_&#34;</span> --output<span class=o>=</span><span class=s2>&#34;locales/my-domain.pot&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>The <code>.pot</code> file can be overwritten as you please since it only holds generated content. The <code>.po</code> files are more important since you don&rsquo;t want to re-do all translations. For this reason we use <code>msgmerge</code> to update the <code>.po</code> files with the new template:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>msgmerge <span class=s2>&#34;locales/de/my-domain.po&#34;</span> <span class=s2>&#34;locales/my-domain.pot&#34;</span> --output-file<span class=o>=</span><span class=s2>&#34;locales/de/my-domain.po&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>The tool takes the current <code>.po</code> file and the new <code>.pot</code> file as input and spits out an updated <code>.po</code> file that keeps your existing translations as long as they are still used.</p><h3 id=automating-and-integrating-with-cmake>Automating and integrating with CMake<a hidden class=anchor aria-hidden=true href=#automating-and-integrating-with-cmake>#</a></h3><p>If you found all of this extremely tedious to do by hand then you are not alone. Of course we can automate the generating and updating for all the required files as well as copying the <code>.mo</code> files to our output at build time using a CMake script.</p><p>To get started, grab a copy <a href=https://github.com/erri120/Gettext-CMake/blob/master/Gettext_helpers.cmake>this script</a> or add the repository as a submodule. In your <code>CMakeLists.txt</code> file we need to add some lines:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=c># setup gettext
</span></span></span><span class=line><span class=cl><span class=c></span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>GETTEXT_DOMAIN</span> <span class=s2>&#34;my-domain&#34;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>GETTEXT_TARGET</span> <span class=s2>&#34;gettext-target&#34;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>GETTEXT_OUTPUT_DIR</span> <span class=s2>&#34;locales&#34;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>set</span><span class=p>(</span><span class=s>GETTEXT_LANGUAGES</span> <span class=s2>&#34;en&#34;</span> <span class=s2>&#34;de&#34;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>target_compile_definitions</span><span class=p>(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s2>&#34;GETTEXT_DOMAIN=\&#34;</span><span class=o>${</span><span class=nv>GETTEXT_DOMAIN</span><span class=o>}</span><span class=s>\&#34;&#34;)</span>
</span></span><span class=line><span class=cl><span class=s>target_compile_definitions(</span><span class=o>${</span><span class=nv>PROJECT_NAME</span><span class=o>}</span> <span class=s>PUBLIC</span> <span class=s2>&#34;GETTEXT_OUTPUT_DIR=\&#34;</span><span class=o>${</span><span class=nv>GETTEXT_OUTPUT_DIR</span><span class=o>}</span><span class=s>\&#34;&#34;)</span>
</span></span></code></pre></td></tr></table></div></div><p>First we specify some variables and add <code>GETTEXT_DOMAIN</code> and <code>GETTEXT_OUTPUT_DIR</code> as a predefined macro so we can use it in our code. I suggest you change the domain name and the list of languages you want to use.</p><p>Next we want to add the previously downloaded script:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-cmake data-lang=cmake><span class=line><span class=cl><span class=nb>include</span><span class=p>(</span><span class=s2>&#34;extern/gettext-cmake/Gettext_helpers.cmake&#34;</span><span class=p>)</span><span class=err>
</span></span></span><span class=line><span class=cl><span class=err></span><span class=nb>CONFIGURE_GETTEXT</span><span class=p>(</span>
</span></span><span class=line><span class=cl> <span class=s>DOMAIN</span> <span class=o>${</span><span class=nv>GETTEXT_DOMAIN</span><span class=o>}</span>
</span></span><span class=line><span class=cl> <span class=s>TARGET_NAME</span> <span class=o>${</span><span class=nv>GETTEXT_TARGET</span><span class=o>}</span>
</span></span><span class=line><span class=cl> <span class=s>SOURCES</span> <span class=s2>&#34;main.cpp&#34;</span>
</span></span><span class=line><span class=cl> <span class=s>POTFILE_DESTINATION</span> <span class=o>${</span><span class=nv>GETTEXT_OUTPUT_DIR</span><span class=o>}</span>
</span></span><span class=line><span class=cl> <span class=s>XGETTEXT_ARGS</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;--keyword=_&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;--add-comments=TRANSLATORS:&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;--package-name=${PROJECT_NAME}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;--package-version=${PROJECT_VERSION}&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;--msgid-bugs-address=&lt;https://github.com/erri120/${PROJECT_NAME}/issues&gt;&#34;</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;--copyright-holder=erri120&#34;</span>
</span></span><span class=line><span class=cl> <span class=s>LANGUAGES</span> <span class=o>${</span><span class=nv>GETTEXT_LANGUAGES</span><span class=o>}</span>
</span></span><span class=line><span class=cl> <span class=s>BUILD_DESTINATION</span> <span class=o>$&lt;</span><span class=nv>TARGET_FILE_DIR:${PROJECT_NAME}</span><span class=o>&gt;</span><span class=s>/</span><span class=o>${</span><span class=nv>GETTEXT_OUTPUT_DIR</span><span class=o>}</span>
</span></span><span class=line><span class=cl> <span class=s>ALL</span>
</span></span><span class=line><span class=cl><span class=p>)</span><span class=err>
</span></span></span></code></pre></td></tr></table></div></div><p>There is lots to configure so let&rsquo;s go through it all:</p><ul><li><code>DOMAIN</code> set the domain name</li><li><code>TARGET_NAME</code>: set the CMake target name</li><li><code>SOURCES</code>: set a list of all source files that <code>xgettext</code> should look through, I suggest creating some variable that holds all your sources</li><li><code>POTFILE_DESTINATION</code>: this is the directory where the <code>.pot</code> file goes</li><li><code>XGETTEXT_ARGS</code>: most of the extra arguments supplied are just for flavor like specifying the package name, version as well as the address where you can report bugs and the copyright holder</li><li><code>LANGAUGES</code>: set the list of languages we want to support</li><li><code>BUILD_DESTINATION</code>: the top-level output folder for the generated <code>.mo</code> files</li><li><code>ALL</code>: adds the custom CMake target to the default build target so that it will be run every time</li></ul><p>And that&rsquo;s it. Doing a CMake configure will generate the <code>.pot</code> and <code>.po</code> files, and you now have some new targets that will generate the <code>.mo</code> files.</p><h3 id=complete-code-example>Complete Code Example<a hidden class=anchor aria-hidden=true href=#complete-code-example>#</a></h3><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c++ data-lang=c++><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;iostream&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;cstdlib&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;libintl.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#if WIN32
</span></span></span><span class=line><span class=cl><span class=cp>#define WIN32_LEAN_AND_MEAN
</span></span></span><span class=line><span class=cl><span class=cp>#include</span> <span class=cpf>&lt;Windows.h&gt;</span><span class=cp>
</span></span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=cp>#define _(STRING) gettext(STRING)
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl><span class=k>static</span> <span class=kt>void</span> <span class=nf>setup_i18n</span><span class=p>(</span><span class=k>const</span> <span class=n>std</span><span class=o>::</span><span class=n>string_view</span> <span class=n>locale</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=cp>#if WIN32
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=c1>// LocaleNameToLCID requires a LPCWSTR so we need to convert from char to wchar_t
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=k>const</span> <span class=k>auto</span> <span class=n>wStringSize</span> <span class=o>=</span> <span class=n>MultiByteToWideChar</span><span class=p>(</span><span class=n>CP_UTF8</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>locale</span><span class=p>.</span><span class=n>data</span><span class=p>(),</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>locale</span><span class=p>.</span><span class=n>length</span><span class=p>()),</span> <span class=k>nullptr</span><span class=p>,</span> <span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>wstring</span> <span class=n>localeName</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>localeName</span><span class=p>.</span><span class=n>reserve</span><span class=p>(</span><span class=n>wStringSize</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>MultiByteToWideChar</span><span class=p>(</span><span class=n>CP_UTF8</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>locale</span><span class=p>.</span><span class=n>data</span><span class=p>(),</span> <span class=k>static_cast</span><span class=o>&lt;</span><span class=kt>int</span><span class=o>&gt;</span><span class=p>(</span><span class=n>locale</span><span class=p>.</span><span class=n>length</span><span class=p>()),</span> <span class=n>localeName</span><span class=p>.</span><span class=n>data</span><span class=p>(),</span> <span class=n>wStringSize</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>_configthreadlocale</span><span class=p>(</span><span class=n>_DISABLE_PER_THREAD_LOCALE</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>const</span> <span class=k>auto</span> <span class=n>localeId</span> <span class=o>=</span> <span class=n>LocaleNameToLCID</span><span class=p>(</span><span class=n>localeName</span><span class=p>.</span><span class=n>c_str</span><span class=p>(),</span> <span class=n>LOCALE_ALLOW_NEUTRAL_NAMES</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>SetThreadLocale</span><span class=p>(</span><span class=n>localeId</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=cp>#else
</span></span></span><span class=line><span class=cl><span class=cp></span>  <span class=n>setlocale</span><span class=p>(</span><span class=n>LC_MESSAGES</span><span class=p>,</span> <span class=n>locale</span><span class=p>.</span><span class=n>data</span><span class=p>());</span>
</span></span><span class=line><span class=cl><span class=cp>#endif
</span></span></span><span class=line><span class=cl><span class=cp></span>
</span></span><span class=line><span class=cl>  <span class=n>bindtextdomain</span><span class=p>(</span><span class=n>GETTEXT_DOMAIN</span><span class=p>,</span> <span class=n>GETTEXT_OUTPUT_DIR</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>bind_textdomain_codeset</span><span class=p>(</span><span class=n>GETTEXT_DOMAIN</span><span class=p>,</span> <span class=s>&#34;UTF-8&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>textdomain</span><span class=p>(</span><span class=n>GETTEXT_DOMAIN</span><span class=p>);</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kt>int</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=n>setup_i18n</span><span class=p>(</span><span class=s>&#34;de&#34;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=n>std</span><span class=o>::</span><span class=n>cout</span> <span class=o>&lt;&lt;</span> <span class=n>_</span><span class=p>(</span><span class=s>&#34;Hello World!&#34;</span><span class=p>)</span> <span class=o>&lt;&lt;</span> <span class=n>std</span><span class=o>::</span><span class=n>endl</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=n>EXIT_SUCCESS</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Woah, what happened with our 12 lines of code? Things are sadly not as easy as you want them to be. The main function is still the same, we have our marked string <code>Hello World!</code> but now there is the new function <code>setup_i18n</code>.</p><p>This new function takes a <a href=https://en.cppreference.com/w/cpp/string/basic_string_view><code>std::string_view</code></a> as an argument and sets the current locale to something new. In this case I want to change the locale to <code>de</code> so my German translation for <code>Hello World!</code> can be loaded. In your actual code you&rsquo;d want to have some language option the user can change which would call this function with the new locale.</p><p>The thing that makes this messy is of course the difference between systems. On a POSIX compliant system you can just call <code>setlocale(LC_MESSAGES, "de")</code>, but this doesn&rsquo;t work at all for Windows.</p><p>On Windows you need to use <code>SetThreadLocale</code> which requires a locale ID that you can get from a name like <code>de</code> using <code>LocaleNameToLCID</code>. The <code>_configthreadlocale(_DISABLE_PER_THREAD_LOCALE)</code> call is important because <code>SetThreadLocale</code> only affects the current thread, who would have thought, so we want to disable this behavior and change the locale of this and all future threads.</p><p>The code after that uses the new predefined macros we added in our CMake file and I also added a call to the very useful <code>bind_textdomain_codeset</code> function. I suggest reading my <a href=https://erri120.github.io/posts/2022-04-15/>Character encodings and Unicode</a> where I explain the mess that is Code Pages and Unicode. With this function call <code>gettext</code> will always return a UTF-8 string. If you don&rsquo;t want that or don&rsquo;t need that you can remove this call but for frameworks like GTK it is required as they accept UTF-8 only.</p><h3 id=alternatives>Alternatives<a hidden class=anchor aria-hidden=true href=#alternatives>#</a></h3><p>GNU gettext has been around for over 30 years, it is battle tested, has great support and a matured ecosystem. However, if this is not for you or if you can&rsquo;t use it there are a few alternatives available:</p><ul><li>DIY: always possible but highly discouraged</li><li><a href=https://doc.qt.io/qt-5/linguist-overview.html>Qt</a>: of course the Qt-ecosystem has a different way of doing translations</li><li><a href=https://icu.unicode.org/>ICU</a>: International Components for Unicode have ICU4C however it is not easy to use at all</li><li><a href=https://www.boost.org/doc/libs/1_70_0/libs/locale/doc/html/index.html>Boost.Locale</a> they use ICU as a backend</li><li><a href=https://www.man7.org/linux/man-pages/man3/catgets.3.html>POSIX: catgets</a> this was created back in 1987 before GNU gettext</li><li><a href=https://docs.microsoft.com/en-us/windows/win32/api/winuser/nf-winuser-loadstringa>Win32: LoadString</a> with this you can load string resources by ID</li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://erri120.github.io/tags/c++/>C++</a></li><li><a href=https://erri120.github.io/tags/i18n/>I18n</a></li></ul><nav class=paginav><a class=next href=https://erri120.github.io/posts/2022-04-15/><span class=title>Next »</span><br><span>Everything about Unicode, Code Pages and Character Encoding</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Getting started with GNU gettext for C++ on x" href="https://x.com/intent/tweet/?text=Getting%20started%20with%20GNU%20gettext%20for%20C%2b%2b&amp;url=https%3a%2f%2ferri120.github.io%2fposts%2f2022-05-05%2f&amp;hashtags=C%2b%2b%2ci18n"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Getting started with GNU gettext for C++ on reddit" href="https://reddit.com/submit?url=https%3a%2f%2ferri120.github.io%2fposts%2f2022-05-05%2f&title=Getting%20started%20with%20GNU%20gettext%20for%20C%2b%2b"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li></ul></footer><script src=https://utteranc.es/client.js repo=erri120/erri120.github.io issue-term=pathname label=site-comment theme=github-light crossorigin=anonymous async></script></article></main><footer class=footer><span>&copy; 2025 <a href=https://erri120.github.io/>erri120's random Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>